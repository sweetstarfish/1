<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¼šå‘˜ç©ºé—´ - ç”µå½±åä¼š</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
  <div class="navbar">
    <span class="brand">ğŸ¬ ç”µå½±åä¼š</span>
    <nav class="nav">
      <a href="/">é¦–é¡µ</a>
      <a href="/movies">ç”µå½±åº“</a>
      <a href="/movie/events">æ´»åŠ¨å®‰æ’</a>
      <a href="/public/news">åä¼šèµ„è®¯</a>
      <a href="/apply">ä¼šå‘˜ç”³è¯·</a>
    </nav>
  </div>

  <div class="container">
    <!-- Flashæ¶ˆæ¯æ˜¾ç¤º -->
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for message in messages %}
          <div class="section">
            <div class="flash-message">
              {{ message }}
            </div>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="section">
      <h1>ğŸ¬ ä¼šå‘˜ç©ºé—´</h1>
      <p>æ¬¢è¿å›æ¥ï¼Œ{{ user.nickname or user.username }}ï¼</p>
    </div>

    <div class="section">
      <h2>ä¸ªäººèµ„æ–™ä¿®æ”¹</h2>
    <form method="post" action="/user/profile/update">
        <div class="form-group">
          <label>æ˜µç§°ï¼š</label>
          <input type="text" name="nickname" value="{{ user.nickname or '' }}">
        </div>
        <div class="form-group">
          <label>æ ‡ç­¾ï¼š</label>
          <input type="text" name="tags" value="{{ user.tags or '' }}" placeholder="ä¾‹å¦‚ï¼šç§‘å¹»è¿·ã€ç»å…¸ç”µå½±çˆ±å¥½è€…">
        </div>
        <button type="submit" class="submit-btn">æ›´æ–°èµ„æ–™</button>
    </form>
    </div>
    
    <div class="section">
      <h2>å¥½å‹ç®¡ç†</h2>
      <div class="friend-section">
        <form method="post" action="/user/friend/add" class="friend-form">
          <div class="form-group">
            <label>æ·»åŠ å¥½å‹ï¼š</label>
            <input type="text" name="friend_name" placeholder="è¾“å…¥å¥½å‹ç”¨æˆ·å" required>
          </div>
          <button type="submit" class="submit-btn">æ·»åŠ å¥½å‹</button>
    </form>
        
        <div class="user-search">
          <h3>æœç´¢ç”¨æˆ·</h3>
          <input type="text" id="searchInput" placeholder="è¾“å…¥ç”¨æˆ·åæˆ–æ˜µç§°æœç´¢...">
          <div id="userList"></div>
        </div>
        
        <h3>æˆ‘çš„å¥½å‹åˆ—è¡¨</h3>
        <ul class="friend-list">
      {% for f in friends %}
        <li>
          <a class="friend-link" href="/friend_space/{{ f.id }}">{{ f.nickname or f.username }}</a>
              <form method="post" action="/user/friend/remove" style="display:inline;">
              <input type="hidden" name="friend_id" value="{{ f.id }}">
                  <button type="submit" class="remove-btn">åˆ é™¤</button>
          </form>
        </li>
      {% else %}
            <li style="color: #666; font-style: italic;">æš‚æ— å¥½å‹ï¼Œå¿«å»æ·»åŠ å§ï¼</li>
      {% endfor %}
    </ul>
      </div>
    </div>

    <div class="section">
      <h2>å‘å¸ƒæ–°æ—¥å¿—</h2>
    <form method="post" action="/user/log/post_form">
        <div class="form-group">
          <label>åˆ†äº«ä½ çš„è§‚å½±å¿ƒå¾—ï¼š</label>
          <textarea name="content" placeholder="è®°å½•ä»Šå¤©çš„å¿ƒæƒ…æˆ–è§‚å½±æ„Ÿå—..."></textarea>
        </div>
        <button type="submit" class="submit-btn">å‘å¸ƒ</button>
    </form>
    </div>

    <div class="section">
      <h2>æˆ‘çš„æ—¥å¿—</h2>
      <ul class="log-list">
      {% for l in logs %}
        <li>{{ l.content }} <span style="color:#888;">({{ l.created_at.strftime('%Y-%m-%d') }})</span></li>
      {% else %}
        <li>æš‚æ— æ—¥å¿—</li>
      {% endfor %}
    </ul>
    </div>

    <div class="section">
      <h2>æˆ‘çš„æ”¶è—</h2>
      <ul class="collection-list">
      {% for news in collected_news %}
        <li><a href="/public/news/{{ news.id }}">{{ news.title }}</a></li>
      {% else %}
        <li>æš‚æ— æ”¶è—</li>
      {% endfor %}
    </ul>
    </div>

    <div class="section">
      <h2>ä¸Šä¼ ç…§ç‰‡</h2>
    <form method="post" action="/user/upload_photo" enctype="multipart/form-data">
        <div class="form-group">
          <label>é€‰æ‹©ç…§ç‰‡ï¼š</label>
      <input type="file" name="file" required>
        </div>
        <div class="form-group">
          <label>æ¯”èµ›åç§°ï¼ˆå¯é€‰ï¼‰ï¼š</label>
          <input type="text" name="contest" placeholder="æ¯”èµ›å">
        </div>
        <button type="submit" class="submit-btn">ä¸Šä¼ </button>
    </form>
    </div>

    {% if photos %}
    <div class="section">
      <h2>æˆ‘çš„ç…§ç‰‡</h2>
      <div style="display: flex; flex-wrap: wrap; gap: 18px;">
        {% for p in photos %}
        <div style="background: #f8f9fa; border-radius: 8px; box-shadow: 0 2px 8px #f0f1f3; padding: 12px 12px 8px 12px; width: 160px; text-align: center;">
          <img src="/static/uploads/{{ p.contest }}/{{ p.filename }}" alt="{{ p.realname }}" style="width: 130px; height: 130px; object-fit: cover; border-radius: 6px; background: #e0e7ef; margin-bottom: 8px;">
          <div style="font-size: 13px; color: #333; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ p.realname }}</div>
          <div style="font-size: 12px; color: #888;">{{ p.uploaded_at.strftime('%Y-%m-%d') }}</div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <div class="section" style="text-align: center;">
      <a href="/user/logout" class="logout-btn">é€€å‡ºç™»å½•</a>
    </div>
  </div>
  
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html> 